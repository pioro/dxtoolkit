use strict;
use Data::Dumper;
use Test::More tests => 5;
use Test::Script;
use LWP::UserAgent;
use lib '../../lib/';
use lib '../';
use lib '.';
use server;




my $server = server->new(8080);
$server->host('127.0.0.1');
$server->background();


script_compiles('../../bin/dx_get_jobs.pl');
script_runs(['../../bin/dx_get_jobs.pl', '-d', 'local', '-format','csv','-st','2018-01-18 12:48:26'] ,  "all jobs test");

my $expected_stdout = <<EOF;
#Appliance,Job ref  ,Target name,Username,Start date,End date,Run time,State,Type
local,JOB-449,Sources/Vfiles_3RSCQ792,N/A,2018-01-19 11:30:03 GMT,2018-01-19 11:30:06 GMT,00:00:03,COMPLETED,DB_SYNC
local,JOB-450,Sources/marina,N/A,2018-01-19 11:30:04 GMT,2018-01-19 11:31:33 GMT,00:01:29,COMPLETED,DB_SYNC
local,JOB-451,Sources/PDBX1,N/A,2018-01-19 11:30:04 GMT,2018-01-19 11:32:30 GMT,00:02:26,COMPLETED,DB_SYNC
local,JOB-452,Sources/carmel,N/A,2018-01-19 11:30:06 GMT,2018-01-19 11:31:49 GMT,00:01:43,COMPLETED,DB_SYNC
local,JOB-453,Sources/Vfiles_3RSCQ792,N/A,2018-01-20 11:30:04 GMT,2018-01-20 11:30:07 GMT,00:00:03,COMPLETED,DB_SYNC
local,JOB-454,Sources/PDBX1,N/A,2018-01-20 11:30:04 GMT,2018-01-20 11:32:59 GMT,00:02:55,COMPLETED,DB_SYNC
local,JOB-455,Sources/marina,N/A,2018-01-20 11:30:04 GMT,2018-01-20 11:32:20 GMT,00:02:16,COMPLETED,DB_SYNC
local,JOB-456,Sources/carmel,N/A,2018-01-20 11:30:05 GMT,2018-01-20 11:32:17 GMT,00:02:12,COMPLETED,DB_SYNC
local,JOB-457,Sources/Vfiles_3RSCQ792,N/A,2018-01-21 11:30:03 GMT,2018-01-21 11:30:06 GMT,00:00:03,COMPLETED,DB_SYNC
local,JOB-458,Sources/marina,N/A,2018-01-21 11:30:03 GMT,2018-01-21 11:32:53 GMT,00:02:50,COMPLETED,DB_SYNC
local,JOB-459,Sources/PDBX1,N/A,2018-01-21 11:30:03 GMT,2018-01-21 11:34:18 GMT,00:04:15,COMPLETED,DB_SYNC
local,JOB-460,Sources/carmel,N/A,2018-01-21 11:30:06 GMT,2018-01-21 11:33:04 GMT,00:02:58,COMPLETED,DB_SYNC
local,JOB-461,Sources/Vfiles_3RSCQ792,N/A,2018-01-22 11:30:02 GMT,2018-01-22 11:30:05 GMT,00:00:03,COMPLETED,DB_SYNC
local,JOB-462,Sources/marina,N/A,2018-01-22 11:30:03 GMT,2018-01-22 11:31:47 GMT,00:01:44,COMPLETED,DB_SYNC
local,JOB-463,Sources/PDBX1,N/A,2018-01-22 11:30:03 GMT,2018-01-22 11:32:50 GMT,00:02:47,COMPLETED,DB_SYNC
local,JOB-464,Sources/carmel,N/A,2018-01-22 11:30:05 GMT,2018-01-22 11:32:11 GMT,00:02:06,COMPLETED,DB_SYNC
local,JOB-465,Sources/Vfiles_3RSCQ792,N/A,2018-01-23 11:30:03 GMT,2018-01-23 11:30:04 GMT,00:00:01,COMPLETED,DB_SYNC
local,JOB-466,,delphix_admin,2018-01-23 16:52:43 GMT,2018-01-23 16:52:55 GMT,00:00:12,COMPLETED,MASKINGJOB_FETCH
local,JOB-467,,delphix_admin,2018-01-23 16:55:00 GMT,2018-01-23 16:55:02 GMT,00:00:02,COMPLETED,MASKINGJOB_FETCH
local,JOB-468,test/testdx,delphix_admin,2018-01-23 16:55:25 GMT,2018-01-23 16:55:26 GMT,00:00:01,FAILED,SOURCE_START
local,JOB-469,test/testdx,delphix_admin,2018-01-23 16:57:09 GMT,2018-01-23 16:57:11 GMT,00:00:02,FAILED,SOURCE_START
local,JOB-470,test/testdx,delphix_admin,2018-01-23 16:58:58 GMT,2018-01-23 17:00:38 GMT,00:01:40,COMPLETED,SOURCE_START
local,JOB-471,cont1,delphix_admin,2018-01-23 17:01:17 GMT,2018-01-23 17:01:44 GMT,00:00:27,COMPLETED,JETSTREAM_ADMIN_CONTAINER_CREATE
local,JOB-472,cont1,delphix_admin,2018-01-23 17:01:18 GMT,2018-01-23 17:01:43 GMT,00:00:25,COMPLETED,JETSTREAM_USER_BRANCH_CREATE
local,JOB-473,test/testdx,delphix_admin,2018-01-23 17:01:18 GMT,2018-01-23 17:01:32 GMT,00:00:14,COMPLETED,DB_SYNC
local,JOB-474,test/testdx,delphix_admin,2018-01-23 17:01:32 GMT,2018-01-23 17:01:43 GMT,00:00:11,COMPLETED,DB_SYNC
local,JOB-475,cont1,delphix_admin,2018-01-23 17:04:58 GMT,2018-01-23 17:09:18 GMT,00:04:20,COMPLETED,JETSTREAM_USER_CONTAINER_RESTORE
local,JOB-476,test/testdx,delphix_admin,2018-01-23 17:04:58 GMT,2018-01-23 17:05:15 GMT,00:00:17,COMPLETED,DB_SYNC
local,JOB-477,marina,delphix_admin,2018-01-23 17:05:16 GMT,2018-01-23 17:09:18 GMT,00:04:02,COMPLETED,JETSTREAM_USER_CONTAINER_UPDATE_SOURCE
local,JOB-478,marina,delphix_admin,2018-01-23 17:05:16 GMT,2018-01-23 17:09:18 GMT,00:04:02,COMPLETED,JETSTREAM_USER_CONTAINER_ATTEMPT_UPDATE_SOURCE
local,JOB-479,test/testdx,delphix_admin,2018-01-23 17:05:17 GMT,2018-01-23 17:09:10 GMT,00:03:53,COMPLETED,DB_ROLLBACK
local,JOB-480,test/testdx,delphix_admin,2018-01-23 17:05:18 GMT,2018-01-23 17:05:33 GMT,00:00:15,COMPLETED,SOURCE_STOP
local,JOB-481,test/testdx,delphix_admin,2018-01-23 17:08:43 GMT,2018-01-23 17:09:08 GMT,00:00:25,COMPLETED,ORACLE_UPDATE_REDOLOGS
local,JOB-482,test/testdx,delphix_admin,2018-01-23 17:09:10 GMT,2018-01-23 17:09:18 GMT,00:00:08,COMPLETED,DB_SYNC
local,JOB-483,cont1,delphix_admin,2018-01-23 17:10:31 GMT,2018-01-23 17:14:24 GMT,00:03:53,COMPLETED,JETSTREAM_USER_CONTAINER_RESTORE
local,JOB-484,test/testdx,delphix_admin,2018-01-23 17:10:32 GMT,2018-01-23 17:10:44 GMT,00:00:12,COMPLETED,DB_SYNC
local,JOB-485,marina,delphix_admin,2018-01-23 17:10:45 GMT,2018-01-23 17:14:24 GMT,00:03:39,COMPLETED,JETSTREAM_USER_CONTAINER_UPDATE_SOURCE
local,JOB-486,marina,delphix_admin,2018-01-23 17:10:45 GMT,2018-01-23 17:14:24 GMT,00:03:39,COMPLETED,JETSTREAM_USER_CONTAINER_ATTEMPT_UPDATE_SOURCE
local,JOB-487,test/testdx,delphix_admin,2018-01-23 17:10:46 GMT,2018-01-23 17:14:16 GMT,00:03:30,COMPLETED,DB_ROLLBACK
local,JOB-488,test/testdx,delphix_admin,2018-01-23 17:10:46 GMT,2018-01-23 17:11:01 GMT,00:00:15,COMPLETED,SOURCE_STOP
local,JOB-489,test/testdx,delphix_admin,2018-01-23 17:13:54 GMT,2018-01-23 17:14:14 GMT,00:00:20,COMPLETED,ORACLE_UPDATE_REDOLOGS
local,JOB-490,test/testdx,delphix_admin,2018-01-23 17:14:16 GMT,2018-01-23 17:14:24 GMT,00:00:08,COMPLETED,DB_SYNC
local,JOB-491,cont1,delphix_admin,2018-01-23 17:19:50 GMT,2018-01-23 17:23:46 GMT,00:03:56,COMPLETED,JETSTREAM_USER_CONTAINER_RESTORE
local,JOB-492,test/testdx,delphix_admin,2018-01-23 17:19:50 GMT,2018-01-23 17:19:59 GMT,00:00:09,COMPLETED,DB_SYNC
local,JOB-493,marina,delphix_admin,2018-01-23 17:19:59 GMT,2018-01-23 17:23:45 GMT,00:03:46,COMPLETED,JETSTREAM_USER_CONTAINER_UPDATE_SOURCE
local,JOB-494,marina,delphix_admin,2018-01-23 17:20:00 GMT,2018-01-23 17:23:45 GMT,00:03:45,COMPLETED,JETSTREAM_USER_CONTAINER_ATTEMPT_UPDATE_SOURCE
local,JOB-495,test/testdx,delphix_admin,2018-01-23 17:20:00 GMT,2018-01-23 17:23:39 GMT,00:03:39,COMPLETED,DB_ROLLBACK
local,JOB-496,test/testdx,delphix_admin,2018-01-23 17:20:01 GMT,2018-01-23 17:20:15 GMT,00:00:14,COMPLETED,SOURCE_STOP
local,JOB-497,test/testdx,delphix_admin,2018-01-23 17:23:16 GMT,2018-01-23 17:23:37 GMT,00:00:21,COMPLETED,ORACLE_UPDATE_REDOLOGS
local,JOB-498,test/testdx,delphix_admin,2018-01-23 17:23:39 GMT,2018-01-23 17:23:45 GMT,00:00:06,COMPLETED,DB_SYNC
local,JOB-499,Sources/Vfiles_3RSCQ792,N/A,2018-01-24 11:30:01 GMT,2018-01-24 11:30:04 GMT,00:00:03,COMPLETED,DB_SYNC
local,JOB-500,test/testdx,N/A,2018-01-24 11:30:01 GMT,2018-01-24 11:30:12 GMT,00:00:11,COMPLETED,DB_SYNC
local,JOB-501,cont1,delphix_admin,2018-01-24 16:40:59 GMT,2018-01-24 16:44:53 GMT,00:03:54,COMPLETED,JETSTREAM_USER_CONTAINER_RESTORE
local,JOB-502,test/testdx,delphix_admin,2018-01-24 16:41:00 GMT,2018-01-24 16:41:06 GMT,00:00:06,COMPLETED,DB_SYNC
local,JOB-503,marina,delphix_admin,2018-01-24 16:41:07 GMT,2018-01-24 16:44:52 GMT,00:03:45,COMPLETED,JETSTREAM_USER_CONTAINER_UPDATE_SOURCE
local,JOB-504,marina,delphix_admin,2018-01-24 16:41:07 GMT,2018-01-24 16:44:51 GMT,00:03:44,COMPLETED,JETSTREAM_USER_CONTAINER_ATTEMPT_UPDATE_SOURCE
local,JOB-505,test/testdx,delphix_admin,2018-01-24 16:41:09 GMT,2018-01-24 16:44:44 GMT,00:03:35,COMPLETED,DB_ROLLBACK
local,JOB-506,test/testdx,delphix_admin,2018-01-24 16:41:10 GMT,2018-01-24 16:41:25 GMT,00:00:15,COMPLETED,SOURCE_STOP
local,JOB-507,test/testdx,delphix_admin,2018-01-24 16:44:17 GMT,2018-01-24 16:44:42 GMT,00:00:25,COMPLETED,ORACLE_UPDATE_REDOLOGS
local,JOB-508,test/testdx,delphix_admin,2018-01-24 16:44:44 GMT,2018-01-24 16:44:51 GMT,00:00:07,COMPLETED,DB_SYNC
local,JOB-509,cont1,delphix_admin,2018-01-24 16:53:59 GMT,2018-01-24 16:56:30 GMT,00:02:31,COMPLETED,JETSTREAM_USER_CONTAINER_REFRESH
local,JOB-510,test/testdx,delphix_admin,2018-01-24 16:54:00 GMT,2018-01-24 16:54:03 GMT,00:00:03,COMPLETED,DB_SYNC
local,JOB-511,marina,delphix_admin,2018-01-24 16:54:04 GMT,2018-01-24 16:56:30 GMT,00:02:26,COMPLETED,JETSTREAM_USER_CONTAINER_UPDATE_SOURCE
local,JOB-512,marina,delphix_admin,2018-01-24 16:54:04 GMT,2018-01-24 16:56:30 GMT,00:02:26,COMPLETED,JETSTREAM_USER_CONTAINER_ATTEMPT_UPDATE_SOURCE
local,JOB-513,test/testdx,delphix_admin,2018-01-24 16:54:05 GMT,2018-01-24 16:56:23 GMT,00:02:18,COMPLETED,DB_REFRESH
local,JOB-514,test/testdx,delphix_admin,2018-01-24 16:54:05 GMT,2018-01-24 16:54:19 GMT,00:00:14,COMPLETED,SOURCE_STOP
local,JOB-515,test/testdx,delphix_admin,2018-01-24 16:56:23 GMT,2018-01-24 16:56:30 GMT,00:00:07,COMPLETED,DB_SYNC
local,JOB-516,cont1,delphix_admin,2018-01-24 17:03:08 GMT,2018-01-24 17:07:16 GMT,00:04:08,COMPLETED,JETSTREAM_USER_CONTAINER_RESET
local,JOB-517,test/testdx,delphix_admin,2018-01-24 17:03:16 GMT,2018-01-24 17:03:30 GMT,00:00:14,COMPLETED,DB_SYNC
local,JOB-518,marina,delphix_admin,2018-01-24 17:03:31 GMT,2018-01-24 17:07:16 GMT,00:03:45,COMPLETED,JETSTREAM_USER_CONTAINER_UPDATE_SOURCE
local,JOB-519,marina,delphix_admin,2018-01-24 17:03:31 GMT,2018-01-24 17:07:16 GMT,00:03:45,COMPLETED,JETSTREAM_USER_CONTAINER_ATTEMPT_UPDATE_SOURCE
local,JOB-520,test/testdx,delphix_admin,2018-01-24 17:03:32 GMT,2018-01-24 17:07:11 GMT,00:03:39,COMPLETED,DB_ROLLBACK
local,JOB-521,test/testdx,delphix_admin,2018-01-24 17:03:32 GMT,2018-01-24 17:03:48 GMT,00:00:16,COMPLETED,SOURCE_STOP
local,JOB-522,test/testdx,delphix_admin,2018-01-24 17:06:26 GMT,2018-01-24 17:07:10 GMT,00:00:44,COMPLETED,ORACLE_UPDATE_REDOLOGS
local,JOB-523,test/testdx,delphix_admin,2018-01-24 17:07:12 GMT,2018-01-24 17:07:16 GMT,00:00:04,COMPLETED,DB_SYNC
local,JOB-524,Sources/Vfiles_3RSCQ792,N/A,2018-01-25 11:30:02 GMT,2018-01-25 11:30:04 GMT,00:00:02,COMPLETED,DB_SYNC
local,JOB-525,test/testdx,N/A,2018-01-25 11:30:03 GMT,2018-01-25 11:30:11 GMT,00:00:08,COMPLETED,DB_SYNC
local,JOB-526,cont1,delphix_admin,2018-01-25 11:30:45 GMT,2018-01-25 11:33:57 GMT,00:03:12,COMPLETED,JETSTREAM_USER_CONTAINER_REFRESH
local,JOB-527,test/testdx,delphix_admin,2018-01-25 11:30:45 GMT,2018-01-25 11:30:51 GMT,00:00:06,COMPLETED,DB_SYNC
local,JOB-528,marina,delphix_admin,2018-01-25 11:30:51 GMT,2018-01-25 11:33:56 GMT,00:03:05,COMPLETED,JETSTREAM_USER_CONTAINER_UPDATE_SOURCE
local,JOB-529,marina,delphix_admin,2018-01-25 11:30:51 GMT,2018-01-25 11:33:56 GMT,00:03:05,COMPLETED,JETSTREAM_USER_CONTAINER_ATTEMPT_UPDATE_SOURCE
local,JOB-530,test/testdx,delphix_admin,2018-01-25 11:30:52 GMT,2018-01-25 11:33:47 GMT,00:02:55,COMPLETED,DB_REFRESH
local,JOB-531,test/testdx,delphix_admin,2018-01-25 11:30:52 GMT,2018-01-25 11:31:08 GMT,00:00:16,COMPLETED,SOURCE_STOP
local,JOB-532,test/testdx,delphix_admin,2018-01-25 11:33:48 GMT,2018-01-25 11:33:56 GMT,00:00:08,COMPLETED,DB_SYNC
local,JOB-533,,delphix_admin,2018-01-25 11:33:53 GMT,2018-01-25 11:34:01 GMT,00:00:08,COMPLETED,MASKINGJOB_FETCH
local,JOB-534,cont1,delphix_admin,2018-01-25 11:34:07 GMT,2018-01-25 11:38:18 GMT,00:04:11,COMPLETED,JETSTREAM_USER_CONTAINER_RESET
local,JOB-535,test/testdx,delphix_admin,2018-01-25 11:34:07 GMT,2018-01-25 11:34:14 GMT,00:00:07,COMPLETED,DB_SYNC
local,JOB-536,marina,delphix_admin,2018-01-25 11:34:14 GMT,2018-01-25 11:38:18 GMT,00:04:04,COMPLETED,JETSTREAM_USER_CONTAINER_UPDATE_SOURCE
local,JOB-537,marina,delphix_admin,2018-01-25 11:34:14 GMT,2018-01-25 11:38:18 GMT,00:04:04,COMPLETED,JETSTREAM_USER_CONTAINER_ATTEMPT_UPDATE_SOURCE
local,JOB-538,test/testdx,delphix_admin,2018-01-25 11:34:15 GMT,2018-01-25 11:38:09 GMT,00:03:54,COMPLETED,DB_ROLLBACK
local,JOB-539,test/testdx,delphix_admin,2018-01-25 11:34:15 GMT,2018-01-25 11:34:31 GMT,00:00:16,COMPLETED,SOURCE_STOP
local,JOB-540,test/testdx,delphix_admin,2018-01-25 11:37:20 GMT,2018-01-25 11:38:06 GMT,00:00:46,COMPLETED,ORACLE_UPDATE_REDOLOGS
local,JOB-541,test/testdx,delphix_admin,2018-01-25 11:38:09 GMT,2018-01-25 11:38:17 GMT,00:00:08,COMPLETED,DB_SYNC
local,JOB-542,cont1,delphix_admin,2018-01-25 12:00:39 GMT,2018-01-25 12:00:44 GMT,00:00:05,COMPLETED,JETSTREAM_USER_CONTAINER_DELETE
local,JOB-543,cont1,delphix_admin,2018-01-25 12:02:29 GMT,2018-01-25 12:04:57 GMT,00:02:28,COMPLETED,JETSTREAM_ADMIN_CONTAINER_CREATE
local,JOB-544,cont1,delphix_admin,2018-01-25 12:02:29 GMT,2018-01-25 12:04:57 GMT,00:02:28,COMPLETED,JETSTREAM_USER_BRANCH_CREATE
local,JOB-545,test/testdx,delphix_admin,2018-01-25 12:02:30 GMT,2018-01-25 12:02:34 GMT,00:00:04,COMPLETED,DB_SYNC
local,JOB-546,marina,delphix_admin,2018-01-25 12:02:34 GMT,2018-01-25 12:04:57 GMT,00:02:23,COMPLETED,JETSTREAM_USER_CONTAINER_UPDATE_SOURCE
local,JOB-547,marina,delphix_admin,2018-01-25 12:02:34 GMT,2018-01-25 12:04:57 GMT,00:02:23,COMPLETED,JETSTREAM_USER_CONTAINER_ATTEMPT_UPDATE_SOURCE
local,JOB-548,test/testdx,delphix_admin,2018-01-25 12:02:36 GMT,2018-01-25 12:04:49 GMT,00:02:13,COMPLETED,DB_REFRESH
local,JOB-549,test/testdx,delphix_admin,2018-01-25 12:02:36 GMT,2018-01-25 12:02:51 GMT,00:00:15,COMPLETED,SOURCE_STOP
local,JOB-550,test/testdx,delphix_admin,2018-01-25 12:04:50 GMT,2018-01-25 12:04:57 GMT,00:00:07,COMPLETED,DB_SYNC
EOF

script_stdout_is $expected_stdout, "jobs results compare";

script_runs(['../../bin/dx_get_jobs.pl', '-d', 'local', '-format','csv','-st','2018-01-20 12:00:00','-dbname','testdx'] ,  "testdx jobs test");

my $expected_stdout = <<EOF;
#Appliance,Job ref  ,Target name,Username,Start date,End date,Run time,State,Type
local,JOB-473,test/testdx,delphix_admin,2018-01-23 17:01:18 GMT,2018-01-23 17:01:32 GMT,00:00:14,COMPLETED,DB_SYNC
local,JOB-474,test/testdx,delphix_admin,2018-01-23 17:01:32 GMT,2018-01-23 17:01:43 GMT,00:00:11,COMPLETED,DB_SYNC
local,JOB-476,test/testdx,delphix_admin,2018-01-23 17:04:58 GMT,2018-01-23 17:05:15 GMT,00:00:17,COMPLETED,DB_SYNC
local,JOB-479,test/testdx,delphix_admin,2018-01-23 17:05:17 GMT,2018-01-23 17:09:10 GMT,00:03:53,COMPLETED,DB_ROLLBACK
local,JOB-482,test/testdx,delphix_admin,2018-01-23 17:09:10 GMT,2018-01-23 17:09:18 GMT,00:00:08,COMPLETED,DB_SYNC
local,JOB-484,test/testdx,delphix_admin,2018-01-23 17:10:32 GMT,2018-01-23 17:10:44 GMT,00:00:12,COMPLETED,DB_SYNC
local,JOB-487,test/testdx,delphix_admin,2018-01-23 17:10:46 GMT,2018-01-23 17:14:16 GMT,00:03:30,COMPLETED,DB_ROLLBACK
local,JOB-490,test/testdx,delphix_admin,2018-01-23 17:14:16 GMT,2018-01-23 17:14:24 GMT,00:00:08,COMPLETED,DB_SYNC
local,JOB-492,test/testdx,delphix_admin,2018-01-23 17:19:50 GMT,2018-01-23 17:19:59 GMT,00:00:09,COMPLETED,DB_SYNC
local,JOB-495,test/testdx,delphix_admin,2018-01-23 17:20:00 GMT,2018-01-23 17:23:39 GMT,00:03:39,COMPLETED,DB_ROLLBACK
local,JOB-498,test/testdx,delphix_admin,2018-01-23 17:23:39 GMT,2018-01-23 17:23:45 GMT,00:00:06,COMPLETED,DB_SYNC
local,JOB-500,test/testdx,N/A,2018-01-24 11:30:01 GMT,2018-01-24 11:30:12 GMT,00:00:11,COMPLETED,DB_SYNC
local,JOB-502,test/testdx,delphix_admin,2018-01-24 16:41:00 GMT,2018-01-24 16:41:06 GMT,00:00:06,COMPLETED,DB_SYNC
local,JOB-505,test/testdx,delphix_admin,2018-01-24 16:41:09 GMT,2018-01-24 16:44:44 GMT,00:03:35,COMPLETED,DB_ROLLBACK
local,JOB-508,test/testdx,delphix_admin,2018-01-24 16:44:44 GMT,2018-01-24 16:44:51 GMT,00:00:07,COMPLETED,DB_SYNC
local,JOB-510,test/testdx,delphix_admin,2018-01-24 16:54:00 GMT,2018-01-24 16:54:03 GMT,00:00:03,COMPLETED,DB_SYNC
local,JOB-513,test/testdx,delphix_admin,2018-01-24 16:54:05 GMT,2018-01-24 16:56:23 GMT,00:02:18,COMPLETED,DB_REFRESH
local,JOB-515,test/testdx,delphix_admin,2018-01-24 16:56:23 GMT,2018-01-24 16:56:30 GMT,00:00:07,COMPLETED,DB_SYNC
local,JOB-517,test/testdx,delphix_admin,2018-01-24 17:03:16 GMT,2018-01-24 17:03:30 GMT,00:00:14,COMPLETED,DB_SYNC
local,JOB-520,test/testdx,delphix_admin,2018-01-24 17:03:32 GMT,2018-01-24 17:07:11 GMT,00:03:39,COMPLETED,DB_ROLLBACK
local,JOB-523,test/testdx,delphix_admin,2018-01-24 17:07:12 GMT,2018-01-24 17:07:16 GMT,00:00:04,COMPLETED,DB_SYNC
local,JOB-525,test/testdx,N/A,2018-01-25 11:30:03 GMT,2018-01-25 11:30:11 GMT,00:00:08,COMPLETED,DB_SYNC
local,JOB-527,test/testdx,delphix_admin,2018-01-25 11:30:45 GMT,2018-01-25 11:30:51 GMT,00:00:06,COMPLETED,DB_SYNC
local,JOB-530,test/testdx,delphix_admin,2018-01-25 11:30:52 GMT,2018-01-25 11:33:47 GMT,00:02:55,COMPLETED,DB_REFRESH
local,JOB-532,test/testdx,delphix_admin,2018-01-25 11:33:48 GMT,2018-01-25 11:33:56 GMT,00:00:08,COMPLETED,DB_SYNC
local,JOB-535,test/testdx,delphix_admin,2018-01-25 11:34:07 GMT,2018-01-25 11:34:14 GMT,00:00:07,COMPLETED,DB_SYNC
local,JOB-538,test/testdx,delphix_admin,2018-01-25 11:34:15 GMT,2018-01-25 11:38:09 GMT,00:03:54,COMPLETED,DB_ROLLBACK
local,JOB-541,test/testdx,delphix_admin,2018-01-25 11:38:09 GMT,2018-01-25 11:38:17 GMT,00:00:08,COMPLETED,DB_SYNC
local,JOB-545,test/testdx,delphix_admin,2018-01-25 12:02:30 GMT,2018-01-25 12:02:34 GMT,00:00:04,COMPLETED,DB_SYNC
local,JOB-548,test/testdx,delphix_admin,2018-01-25 12:02:36 GMT,2018-01-25 12:04:49 GMT,00:02:13,COMPLETED,DB_REFRESH
local,JOB-550,test/testdx,delphix_admin,2018-01-25 12:04:50 GMT,2018-01-25 12:04:57 GMT,00:00:07,COMPLETED,DB_SYNC
EOF

script_stdout_is $expected_stdout, "jobs results compare";



#stop server
my $ua = LWP::UserAgent->new;
$ua->agent("Delphix Perl Agent/0.1");
$ua->timeout(15);
my $request = HTTP::Request->new(GET => 'http://127.0.0.1:8080/stop');
my $response = $ua->request($request);
